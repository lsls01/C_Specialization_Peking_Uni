"use strict";define("bundles/ondemand/components/programming/ProgrammingItem",["require","exports","module","q","react-router","react-with-addons","underscore","bundles/content-feedback/constants/ItemTypes","bundles/ondemand/components/endOfCourse/components/CourseCompleteModal","bundles/ondemand/components/item/LightItemLayout","bundles/ondemand/components/programming/ProgrammingDeadline","bundles/ondemand/components/programming/ProgrammingNavigation","bundles/phoenix/lib/waitForStores","bundles/phoenix/template/models/userIdentity","bundles/programming/components/MetaInfoArea","bundles/programming/promises/learnerAssignment","bundles/programming/stores/submissionSummariesStore","bundles/verificationDisplay/models/verificationDisplay","js/lib/retracked","pages/open-course/common/models/courseGrade","pages/open-course/common/models/courseProgress","pages/open-course/common/models/itemMetadata","css!./__styles__/ProgrammingItem","css!bundles/programming/styl/index","css!pages/open-course/peerReview/styl/index"],function(require,exports,module){var t=require("q"),p=require("react-router"),r=p.RouteHandler,e=require("react-with-addons"),_=require("underscore"),a=require("bundles/content-feedback/constants/ItemTypes"),o=require("bundles/ondemand/components/endOfCourse/components/CourseCompleteModal"),i=require("bundles/ondemand/components/item/LightItemLayout"),n=require("bundles/ondemand/components/programming/ProgrammingDeadline"),m=require("bundles/ondemand/components/programming/ProgrammingNavigation"),d=require("bundles/phoenix/lib/waitForStores"),M=require("bundles/phoenix/template/models/userIdentity"),c=require("bundles/programming/components/MetaInfoArea"),l=require("bundles/programming/promises/learnerAssignment"),u=require("bundles/programming/stores/submissionSummariesStore"),g=require("bundles/verificationDisplay/models/verificationDisplay"),h=require("js/lib/retracked"),b=require("pages/open-course/common/models/courseGrade"),f=require("pages/open-course/common/models/courseProgress"),y=require("pages/open-course/common/models/itemMetadata");require("css!./__styles__/ProgrammingItem"),require("css!bundles/programming/styl/index"),require("css!pages/open-course/peerReview/styl/index");var s=e.createClass({displayName:"ProgrammingItem",propTypes:{itemMetadata:e.PropTypes.instanceOf(y).isRequired,courseProgress:e.PropTypes.instanceOf(f).isRequired,courseGrade:e.PropTypes.instanceOf(b).isRequired,verificationDisplay:e.PropTypes.instanceOf(g).isRequired,weekNumber:e.PropTypes.number.isRequired},childContextTypes:{track:e.PropTypes.func.isRequired},getChildContext:function getChildContext(){return{track:h.makeTracker({namespace:"open_course_item.programming_header",include:{open_course_id:this.props.itemMetadata.get("course.id"),module_id:this.props.itemMetadata.get("lesson.module.id"),lesson_id:this.props.itemMetadata.get("lesson.id"),item_id:this.props.itemMetadata.get("id")}})}},getInitialState:function getInitialState(){return{learnerAssignment:null}},componentDidMount:function componentDidMount(){this.fetchData()},getTitlePrefix:function getTitlePrefix(){var e="";return this.props.itemMetadata.getTypePrefix()&&(e=this.props.itemMetadata.getTypePrefix()+": "),e},fetchData:function fetchData(){var s=this,e=t(null);"programming"!==this.props.itemMetadata.getTypeName()&&(e=l({itemMetadata:this.props.itemMetadata}));var r=t(null);_(["gradedProgramming","ungradedProgramming"]).contains(this.props.itemMetadata.getTypeName())&&(r=u.load({itemMetadata:this.props.itemMetadata,userId:M.get("id"),courseId:this.props.itemMetadata.get("course.id"),itemId:this.props.itemMetadata.get("id")})),t.all([e,r]).spread(function(e){s.setState({learnerAssignment:e})})},render:function render(){var t=e.createElement(i,{itemMetadata:this.props.itemMetadata,itemType:a.Programming,isCard:!1,feedbackFixedAtBottom:!0},e.createElement("div",{className:"c-peer-review c-body-container bt3-container-fluid styleguide"},e.createElement("div",{className:"c-peer-review-body"},e.createElement("div",{className:"c-peer-review-header"},e.createElement("div",{className:"horizontal-box"},e.createElement("div",{className:"flex-1"},e.createElement("h2",{className:"c-peer-review-title headline-4-text"},this.getTitlePrefix(),this.props.itemMetadata.getName())),e.createElement(o,{courseProgress:this.props.courseProgress})),e.createElement("div",{className:"c-peer-review-state bt3-row"},e.createElement("div",{className:"bt3-col-md-12"},_(["gradedProgramming","ungradedProgramming"]).contains(this.props.itemMetadata.getTypeName())&&e.createElement(c,{itemMetadata:this.props.itemMetadata,learnerAssignment:this.state.learnerAssignment,courseProgress:this.props.courseProgress,courseGrade:this.props.courseGrade,verificationDisplay:this.props.verificationDisplay})))),e.createElement(n,{itemMetadata:this.props.itemMetadata}),e.createElement(m,{itemMetadata:this.props.itemMetadata}),e.createElement(r,{itemMetadata:this.props.itemMetadata}))));return e.createElement("div",{className:"rc-ProgrammingItem c-item-container c-item-programming"},t)}});module.exports=d(s,["ProgressStore","CourseGradeStore","VerificationStore","CourseScheduleStore"],function(e,t){var r=e.ProgressStore,s=e.CourseGradeStore,a=e.VerificationStore,o=e.CourseScheduleStore;return{courseProgress:r.courseProgress,courseGrade:s.courseGrade,verificationDisplay:a.getVerificationDisplay(),weekNumber:o.getSchedule().getWeekForModuleId(t.itemMetadata.get("lesson.module.id"))}})});